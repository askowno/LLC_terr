add_column(YEAR =2022) %>%
rename(LC = nlc2022_7class)
# build a table for the 1750 LC where all is natural- not used much.
tb1750 <- tb1990 %>%
filter(T_MAPCODE != '<Null>'& T_MAPCODE != " " & LC != 0) %>%
mutate (YEAR = 1750) %>%
group_by (YEAR, T_MAPCODE) %>%
summarise(n = sum(n) , .groups = "drop") %>%
mutate(LC = "1") %>% # this in "" because  other LC are char for some reason
relocate(YEAR, .after = LC)%>%
relocate(LC, .before = T_MAPCODE)
# Step 3. add extent based on pixel size and then make raster binary by changing 4 to 2 (not natural pixels) and 3 to 1 (natural pixels)
lc7_list = list(tb1750,tb1990,tb2014,tb2018,tb2020,tb2022)
sa_lc7_rall <- lc7_list %>%  bind_rows() %>%
as_tibble() %>%
filter(T_MAPCODE != '<Null>'& T_MAPCODE != " " & LC != 0) %>%
group_by(LC, YEAR, T_MAPCODE) %>%
summarise(n = sum(n), .groups = "drop") %>%
mutate(BIOME = str_replace_all(
T_MAPCODE,c("AT.*" = "Albany Thicket",
"AZ.*" = "Azonal",
"CB.*" = "IOCB",
"D.*"  = "Desert",
"FF.*" = "Fynbos",
"FR.*" = "Fynbos",
"FS.*" = "Fynbos",
"FO.*" = "Forest",
"G.*" = "Grassland",
"NK.*" = "Nama-Karoo",
"NOTVEG.*" = "NOTVEG",
"SK.*" = "Succulent Karoo",
"SV.*" = "Savanna"))) %>%
mutate(LC7_text = case_when(
LC == 1 ~ "Natural",
LC == 2 ~ "Secondary-natural",
LC == 3 ~ "Artificial-waterbody",
LC == 4 ~ "Built-up",
LC == 5 ~ "Cropland",
LC == 6 ~ "Mine",
LC == 7 ~ "Plantation")) %>%
relocate(BIOME, .after = T_MAPCODE)%>%
mutate(km2 = n*400/1000000)  #CHECK THIS# for test use 16000 for final use 400
write.csv(sa_lc7_rall, file = "sa_lc7_rall.csv")
# This csv can be loaded to excel and using a pivot table summary stats for each type biome LC can be calculated
View(sa_lc7_rall)
lc7_year_km2 <- sa_lc7_rall %>%
filter(YEAR != 1750) %>%
group_by(LC, LC7_text, YEAR) %>%
summarise(total_km2 = sum(km2),.groups = 'drop') %>%
pivot_wider(names_from = YEAR, values_from = total_km2)
View(lc7_year_km2)
test <- sa_lc7_rall %>%
filter(YEAR != 1750) %>%
group_by(YEAR) %>%
summarise(total_km2 = sum(km2),.groups = 'drop')
View(test)
# if required import data from spatial analysis above
# sa_lc7_rall <- read_csv("sa_lc7_rall.csv", show_col_types = FALSE)
# summarise per Veg Type
options(scipen = 999)
lc7_veg_2022_prop <- sa_lc7_rall %>%
filter(YEAR == 2022, T_MAPCODE != "NOTVEG") %>%
group_by(T_MAPCODE, LC7_text) %>%
summarise(total_km2 = sum(km2),.groups = 'drop') %>%
group_by(T_MAPCODE) %>% # do an additional group_by followed by mutate and ungroup to make perc
mutate(proportion = (total_km2 / sum(total_km2))) %>%
ungroup() %>%
select(-total_km2) %>% #remove to make a neat pivot
pivot_wider(names_from = LC7_text, values_from = proportion) %>%
relocate(Natural, .after = T_MAPCODE)  %>%
relocate(`Secondary-natural`, .after = Natural)
write.csv(lc7_veg_2022_prop, file = "results_df_lc7_prop_veg_sa_only.csv")
# example of summary  per LC class  `
crop_biome <- sa_lc7_rall %>%
filter(LC7_text == "Cropland") %>% # change this to LC class you want stats on. Note: use `` around Nama-Karoo as - is not read correctly in column names and functions.
filter(YEAR != 1750) %>%
group_by(BIOME,YEAR) %>%
summarise(total_km2 = sum(km2),.groups = 'drop') %>%
group_by() %>%
mutate(proportion = total_km2 / sum(total_km2)) %>%
select(-total_km2) %>% #remove to make a neat pivot
pivot_wider(names_from = YEAR, values_from = proportion)
# example of summary per biome
lc7_AT <- sa_lc7_rall %>%
filter(YEAR != 1750, BIOME == "Albany Thicket", BIOME != "NOTVEG") %>% # # change this to BIOME you want stats on. Note: use `` around Artificial-waterbody and others with - in name.
group_by(LC,LC7_text, BIOME,YEAR) %>%
summarise(total_km2 = sum(km2),.groups = 'drop')%>%
pivot_wider(names_from = YEAR, values_from = total_km2)
#summary tables of LC per year in km2 and as proportion of SA
lc7_year_km2 <- sa_lc7_rall %>%
filter(YEAR != 1750) %>%
group_by(LC, LC7_text, YEAR) %>%
summarise(total_km2 = sum(km2),.groups = 'drop') %>%
pivot_wider(names_from = YEAR, values_from = total_km2)
write.csv(lc7_year_km2, file = "results_df_lc7_km2_year_sa_only.csv")
lc7_year_prop <- sa_lc7_rall %>%
filter(YEAR != 1750) %>%
group_by(LC, LC7_text,YEAR) %>%
summarise(total_km2 = sum(km2),.groups = 'drop') %>%
group_by(YEAR) %>%
mutate(proportion = total_km2 / sum(total_km2)) %>%
select(-total_km2) %>% #remove to make a neat pivot
pivot_wider(names_from = YEAR, values_from = proportion)
write.csv(lc7_year_prop, file = "results_df_lc7_prop_year_sa_only.csv")
test <- sa_lc7_rall %>%
filter(YEAR != 1750) %>%
group_by(YEAR) %>%
summarise(total_km2 = sum(km2),.groups = 'drop')
## plot the LC by BIOME over time
# make data proportional
options(scipen = 999)
plot_data <- sa_lc7_rall %>%
filter(YEAR != 1750, BIOME != "NOTVEG") %>%
group_by(BIOME, YEAR, LC7_text) %>%
summarise(total_km2 = sum(km2),.groups = 'drop') %>%
group_by(YEAR,BIOME) %>%
mutate(proportion = total_km2 / sum(total_km2))
# set colours for each LC class in the plot
lc_colors <- c(
"Artificial-waterbody" = "blue",
"Natural" = "darkgreen",
"Built-up" = "black",
"Cropland" = "brown",
"Mine" = "red",
"Plantation" = "purple",
"Secondary-natural" = "orange"
)
# set the order for the legend
lc_order <- c("Mine", "Built-up", "Artificial-waterbody", "Cropland", "Plantation","Secondary-natural","Natural")
plot_data$LC7_text <- factor(plot_data$LC7_text, levels = lc_order) # this helps set the order
plot <- ggplot(plot_data, aes(x = as.factor(YEAR), y = proportion, fill = (LC7_text))) +
geom_bar(stat = "identity", position = "stack") +  # Stacked bar chart
scale_fill_manual(values = lc_colors) +
facet_wrap(~ BIOME, ncol = 5) +
theme_minimal() +
labs(
title = "Proportional Extent of Land Cover Classes by Biome and Year",
x = "Year",
y = "Proportional Extent",
fill = "Land Cover Class"
) +
theme(axis.text.x = element_text(angle = 45, hjust = 1),
strip.text = element_text(size = 10),
legend.position = "bottom",
legend.text = element_text(size=7))
#export the graph
ggsave(
filename = "land_cover_biome_year_plot_sa_only.jpeg", # File name
plot = plot,                            # Plot object
device = "jpeg",                        # File format
width = 16, height = 12, units = "cm",   # Dimensions
dpi = 300                               # Resolution
)
## plot the LC by YEAR
options(scipen = 999)
plot_data2 <- sa_lc7_rall %>%
group_by(YEAR, LC7_text) %>%
summarise(total_km2 = sum(km2),.groups = 'drop') %>%
filter(YEAR != 1750)
# set colours for each LC class in the plot
lc_colors <- c(
"Artificial-waterbody" = "blue",
"Natural" = "darkgreen",
"Built-up" = "black",
"Cropland" = "brown",
"Mine" = "red",
"Plantation" = "purple",
"Secondary-natural" = "orange"
)
# set the order for the legend
lc_order <- c("Mine", "Built-up", "Artificial-waterbody", "Cropland", "Plantation","Secondary-natural","Natural")
plot_data2$LC7_text <- factor(plot_data2$LC7_text, levels = lc_order) # this helps set the order
plot2 <- ggplot(plot_data2, aes(x = as.factor(YEAR), y = total_km2, fill = (LC7_text))) +
geom_bar(stat = "identity", position = "stack") +  # Stacked bar chart
scale_fill_manual(values = lc_colors) +
theme_minimal() +
labs(
x = "Year",
y = "Extent Km2",
fill = "Land Cover Class"
) +
theme(axis.text.x = element_text(angle = 45, hjust = 1),
strip.text = element_text(size = 8),
legend.position = "right",
legend.text = element_text(size=8))
#export the graph
ggsave(
filename = "land_cover_year_plot_sa_only.jpeg", # File name
plot = plot2,                            # Plot object
device = "jpeg",                        # File format
width = 12, height = 8, units = "cm",   # Dimensions
dpi = 300                               # Resolution
)
View(lc7_year_prop)
View(lc7_year_km2)
View(lc7_veg_2022_prop)
lc7_list = list(tb1750,tb1990,tb2014,tb2018,tb2020,tb2022)
sa_lc7_rall <- lc7_list %>%  bind_rows() %>%
as_tibble()
View(sa_lc7_rall)
sa_lc7_rall <- lc7_list %>%  bind_rows() %>%
as_tibble() %>%
filter(T_MAPCODE != '<Null>'& T_MAPCODE != " " & LC != 0) %>%
group_by(LC, YEAR, T_MAPCODE) %>%
summarise(n = sum(n), .groups = "drop") %>%
mutate(BIOME = str_replace_all(
T_MAPCODE,c("AT.*" = "Albany Thicket",
"AZ.*" = "Azonal",
"CB.*" = "IOCB",
"D.*"  = "Desert",
"FF.*" = "Fynbos",
"FR.*" = "Fynbos",
"FS.*" = "Fynbos",
"FO.*" = "Forest",
"G.*" = "Grassland",
"NK.*" = "Nama-Karoo",
"NOTVEG.*" = "NOTVEG",
"SK.*" = "Succulent Karoo",
"SV.*" = "Savanna")))
View(sa_lc7_rall)
# Step 3. add extent based on pixel size and then make raster binary by changing 4 to 2 (not natural pixels) and 3 to 1 (natural pixels)
lc7_list = list(tb1750,tb1990,tb2014,tb2018,tb2020,tb2022)
sa_lc7_rall <- lc7_list %>%  bind_rows() %>%
as_tibble() %>%
filter(T_MAPCODE != '<Null>'& T_MAPCODE != " " & LC != 0) %>%
group_by(LC, YEAR, T_MAPCODE) %>%
summarise(n = sum(n), .groups = "drop") %>%
mutate(BIOME = str_replace_all(
T_MAPCODE,c("AT.*" = "Albany Thicket",
"AZ.*" = "Azonal",
"CB.*" = "IOCB",
"D.*"  = "Desert",
"FF.*" = "Fynbos",
"FR.*" = "Fynbos",
"FS.*" = "Fynbos",
"FO.*" = "Forest",
"G.*" = "Grassland",
"NK.*" = "Nama-Karoo",
"NOTVEG.*" = "NOTVEG",
"SK.*" = "Succulent Karoo",
"SV.*" = "Savanna"))) %>%
mutate(LC7_text = case_when(
LC == 1 ~ "Natural",
LC == 2 ~ "Secondary-natural",
LC == 3 ~ "Artificial-waterbody",
LC == 4 ~ "Built-up",
LC == 5 ~ "Cropland",
LC == 6 ~ "Mine",
LC == 7 ~ "Plantation")) %>%
relocate(BIOME, .after = T_MAPCODE)%>%
mutate(km2 = n*400/1000000)  #CHECK THIS# for test use 16000 for final use 400
write.csv(sa_lc7_rall, file = "sa_lc7_rall.csv")
# This csv can be loaded to excel and using a pivot table summary stats for each type biome LC can be calculated
View(sa_lc7_rall)
# if required import data from spatial analysis above
# sa_lc7_rall <- read_csv("sa_lc7_rall.csv", show_col_types = FALSE)
# summarise per Veg Type
options(scipen = 999)
lc7_veg_2022_prop <- sa_lc7_rall %>%
filter(YEAR == 2022, T_MAPCODE != "NOTVEG") %>%
group_by(T_MAPCODE, LC7_text) %>%
summarise(total_km2 = sum(km2),.groups = 'drop') %>%
group_by(T_MAPCODE) %>% # do an additional group_by followed by mutate and ungroup to make perc
mutate(proportion = (total_km2 / sum(total_km2))) %>%
ungroup() %>%
select(-total_km2) %>% #remove to make a neat pivot
pivot_wider(names_from = LC7_text, values_from = proportion) %>%
relocate(Natural, .after = T_MAPCODE)  %>%
relocate(`Secondary-natural`, .after = Natural)
write.csv(lc7_veg_2022_prop, file = "results_df_lc7_prop_veg_sa_only.csv")
# example of summary  per LC class  `
crop_biome <- sa_lc7_rall %>%
filter(LC7_text == "Cropland") %>% # change this to LC class you want stats on. Note: use `` around Nama-Karoo as - is not read correctly in column names and functions.
filter(YEAR != 1750) %>%
group_by(BIOME,YEAR) %>%
summarise(total_km2 = sum(km2),.groups = 'drop') %>%
group_by() %>%
mutate(proportion = total_km2 / sum(total_km2)) %>%
select(-total_km2) %>% #remove to make a neat pivot
pivot_wider(names_from = YEAR, values_from = proportion)
# example of summary per biome
lc7_AT <- sa_lc7_rall %>%
filter(YEAR != 1750, BIOME == "Albany Thicket", BIOME != "NOTVEG") %>% # # change this to BIOME you want stats on. Note: use `` around Artificial-waterbody and others with - in name.
group_by(LC,LC7_text, BIOME,YEAR) %>%
summarise(total_km2 = sum(km2),.groups = 'drop')%>%
pivot_wider(names_from = YEAR, values_from = total_km2)
#summary tables of LC per year in km2 and as proportion of SA
lc7_year_km2 <- sa_lc7_rall %>%
filter(YEAR != 1750) %>%
group_by(LC, LC7_text, YEAR) %>%
summarise(total_km2 = sum(km2),.groups = 'drop') %>%
pivot_wider(names_from = YEAR, values_from = total_km2)
write.csv(lc7_year_km2, file = "results_df_lc7_km2_year_sa_only.csv")
lc7_year_prop <- sa_lc7_rall %>%
filter(YEAR != 1750) %>%
group_by(LC, LC7_text,YEAR) %>%
summarise(total_km2 = sum(km2),.groups = 'drop') %>%
group_by(YEAR) %>%
mutate(proportion = total_km2 / sum(total_km2)) %>%
select(-total_km2) %>% #remove to make a neat pivot
pivot_wider(names_from = YEAR, values_from = proportion)
write.csv(lc7_year_prop, file = "results_df_lc7_prop_year_sa_only.csv")
test <- sa_lc7_rall %>%
filter(YEAR != 1750) %>%
group_by(YEAR) %>%
summarise(total_km2 = sum(km2),.groups = 'drop')
View(test)
View(crop_biome)
lc7_AT <- sa_lc7_rall %>%
filter(YEAR != 1750, BIOME != "Albany Thicket", BIOME = "NOTVEG") %>% # # change this to BIOME you want stats on. Note: use `` around Artificial-waterbody and others with - in name.
group_by(LC,LC7_text, BIOME,YEAR) %>%
summarise(total_km2 = sum(km2),.groups = 'drop')%>%
pivot_wider(names_from = YEAR, values_from = total_km2)
lc7_AT <- sa_lc7_rall %>%
filter(YEAR != 1750, BIOME != "Albany Thicket", BIOME == "NOTVEG") %>% # # change this to BIOME you want stats on. Note: use `` around Artificial-waterbody and others with - in name.
group_by(LC,LC7_text, BIOME,YEAR) %>%
summarise(total_km2 = sum(km2),.groups = 'drop')%>%
pivot_wider(names_from = YEAR, values_from = total_km2)
View(lc7_AT)
lc7_AT <- sa_lc7_rall %>%
filter(YEAR != 1750, BIOME == "Albany Thicket", BIOME != "NOTVEG") %>% # # change this to BIOME you want stats on. Note: use `` around Artificial-waterbody and others with - in name.
group_by(LC,LC7_text, BIOME,YEAR) %>%
summarise(total_km2 = sum(km2),.groups = 'drop')%>%
pivot_wider(names_from = YEAR, values_from = total_km2)
View(lc7_AT)
#load packages
library(terra)
library(tidyverse)
library(sf)
library(PROJ) # seems to be required due to a conflict with postgres on some machines
# Step 3. add extent based on pixel size and then make raster binary by changing 4 to 2 (not natural pixels) and 3 to 1 (natural pixels)
lc7_list = list(tb1750,tb1990,tb2014,tb2018,tb2020,tb2022)
sa_lc7_rall <- lc7_list %>%  bind_rows() %>%
as_tibble() %>%
filter(T_MAPCODE != '<Null>'& T_MAPCODE != " " & LC != 0) %>%
group_by(LC, YEAR, T_MAPCODE) %>%
summarise(n = sum(n), .groups = "drop") %>%
mutate(BIOME = str_replace_all(
T_MAPCODE,c("AT.*" = "Albany Thicket",
"AZ.*" = "Azonal",
"CB.*" = "IOCB",
"D.*"  = "Desert",
"FF.*" = "Fynbos",
"FR.*" = "Fynbos",
"FS.*" = "Fynbos",
"FO.*" = "Forest",
"G.*" = "Grassland",
"NK.*" = "Nama-Karoo",
"NOTVEG.*" = "NOTVEG",
"SK.*" = "Succulent Karoo",
"SV.*" = "Savanna"))) %>%
mutate(LC7_text = case_when(
LC == 1 ~ "Natural",
LC == 2 ~ "Secondary-natural",
LC == 3 ~ "Artificial-waterbody",
LC == 4 ~ "Built-up",
LC == 5 ~ "Cropland",
LC == 6 ~ "Mine",
LC == 7 ~ "Plantation")) %>%
relocate(BIOME, .after = T_MAPCODE)%>%
mutate(km2 = n*400/1000000)  #CHECK THIS# for test use 16000 for final use 400
write.csv(sa_lc7_rall, file = "outputs/sa_lc7_rall.csv")
# This csv can be loaded to excel and using a pivot table summary stats for each type biome LC can be calculated
?source
#load packages
library(terra)
library(tidyverse)
library(sf)
library(PROJ)
#Add CoCT data
coct <- vect("C:/Users/skownoa/Dropbox/NBAwork/RLEworking/CoCT/Terrestrial_Biodiversity_Network.shp")
#vegetation data
veg <- vect("C:/GIS/NBA/VegMap/VEGMAP2024/NVM2024final/NVM2024final.gdb", "NVM2024Final_IEM5_12_07012025")
veg$T_MAPCODE <- ifelse(veg$T_Name == "Non-terrestrial (estuarine habitat)" | veg$T_Name == "Non-terrestrial (Aquatic)", "NOTVEG", veg$T_MAPCODE)
# Add national LC
lc2022 <- rast("C:/Users/skownoa/Dropbox/NBAwork/NLC_change/nlc2022_7class.tif")
coct <- vect("C:/Users/skownoa/Dropbox/NBAwork/RLEworking/CoCT/CoCT_boundary.shp")
cond <- vect("C:/Users/skownoa/Dropbox/NBAwork/RLEworking/CoCT/Terrestrial_Biodiversity_Network_aea.shp")
# Crop nlc to CoCT
nlc <- crop(lc2022, coct)
plot(nlc)
# make coct rasters
coct_r <- rasterize(coct, nlc, "COCT")
plot(coct_r)
plot(coct)
# make coct rasters
coct_r <- rasterize(coct, nlc, "COCT")
coct <- vect("C:/Users/skownoa/Dropbox/NBAwork/RLEworking/CoCT/CoCT_boundary.shp")
cond <- vect("C:/Users/skownoa/Dropbox/NBAwork/RLEworking/CoCT/Terrestrial_Biodiversity_Network_aea.shp")
# Crop nlc to CoCT
nlc <- crop(lc2022, coct)
# make coct rasters
coct_r <- rasterize(coct, nlc, "COCT")
cond_r <- rasterize(cond, nlc, "HBT_CNDT")
plot(cond_r)
print(cond_r)
veg$T_MAPCODE <- ifelse(veg$T_Name == "Non-terrestrial (estuarine habitat)" | veg$T_Name == "Non-terrestrial (Aquatic)", "NOTVEG", veg$T_MAPCODE)
# rasterise the veg vector
vegrast <- rasterize(veg,nlc,"T_MAPCODE")
# Analysis #Step 1-2.   # get LC  at 1990 time period
rall  <- as_tibble(crosstab(c(nlc, vegrast, cond_r, coct_r)))
write.csv(rall, file = "outputs/coct_rall.csv")
View(rall)
# Analysis #Step 1-2.   # get LC  at 1990 time period
coct_rall  <- as_tibble(crosstab(c(nlc, vegrast, cond_r, coct_r), NAflag=TRUE))
cond_r[is.na(cond_r)] <- -99
coct_rall  <- as_tibble(crosstab(c(nlc, vegrast, cond_r, coct_r)))
write.csv(coct_rall, file = "outputs/coct_rall.csv")
View(coct_rall)
#load packages
library(terra)
library(tidyverse)
library(sf)
library(PROJ)
# Add national LC
lc2022 <- rast("C:/Users/skownoa/Dropbox/NBAwork/NLC_change/nlc2022_7class.tif")
# Add national LC
lc2022 <- rast("C:/Users/skownoa/Dropbox/NBAwork/NLC_change/nlc2022_7class.tif")
coct <- vect("C:/Users/skownoa/Dropbox/NBAwork/RLEworking/CoCT/CoCT_boundary.shp")
cond <- vect("C:/Users/skownoa/Dropbox/NBAwork/RLEworking/CoCT/Terrestrial_Biodiversity_Network_aea.shp")
nlc <- rast("C:/Users/skownoa/Dropbox/NBAwork/NLC_change/nlc2022_7class.tif")
#Add CoCT data
coct <- vect("C:/Users/skownoa/Dropbox/NBAwork/RLEworking/CoCT/CoCT_boundary.shp")
# Add national LC
nlc <- rast("C:/Users/skownoa/Dropbox/NBAwork/NLC_change/nlc2022_7class.tif")
#Add CoCT data
coct <- vect("C:/Users/skownoa/Dropbox/NBAwork/RLEworking/CoCT/CoCT_boundary.shp")
cond <- vect("C:/Users/skownoa/Dropbox/NBAwork/RLEworking/CoCT/Terrestrial_Biodiversity_Network_aea.shp")
# make coct rasters
#coct_r <- rasterize(coct, nlc, "COCT")
coct_r <- rasterize(coct, nlc, field = 1, background = 0)
View(cond)
#ensure NA is given value 99
cond_r <- rasterize(cond, nlc, field = "HBT_CNDT", background = 0)
print(cond_r)
plot(cond_r)
plot(cond)
as_tibble(cond)
plot(coct_r)
#ensure NA is given value 99
cond_r <- rasterize(cond, nlc, field = "HBT_CNDT", background = "notcoct")
plot(cond_r)
print(cond_r)
anyNA(cond_r)
cond_r[is.na(cond_r)] <- "notcoct2"
cond_r[is.na(cond_r)] <- 99
plot(cond_r)
view(cond_r)
View(cond_r)
cats(cod_r)
cats(cond_r)
anyNA(cond_r)
plot(cond_r)
veg <- vect("C:/GIS/NBA/VegMap/VEGMAP2024/NVM2024final/NVM2024final.gdb", "NVM2024Final_IEM5_12_07012025")
veg$T_MAPCODE <- ifelse(veg$T_Name == "Non-terrestrial (estuarine habitat)" | veg$T_Name == "Non-terrestrial (Aquatic)", "NOTVEG", veg$T_MAPCODE)
# rasterise the veg vector
vegrast <- rasterize(veg,nlc,"T_MAPCODE")
coct_rall  <- as_tibble(crosstab(c(nlc, vegrast, cond_r, coct_r)))
write.csv(coct_rall, file = "outputs/coct_rall.csv")
View(coct_rall)
coct_rall$HBT_CNDT
unique(coct_rall$HBT_CNDT)
unique(coct_rall)
rall  <- rall  %>%
rename(coct = layer) %>%
rename(LC = nlc1990_7class)
coct_rall  <- coct_rall  %>%
rename(coct = layer) %>%
rename(LC = nlc1990_7class)
coct_rall  <- coct_rall  %>%
rename(coct = layer) %>%
rename(LC = nlc2022_7class)
coct_rall  <- coct_rall  %>%
mutate(km2 = n*400/1000000)
coct_rall  <- coct_rall  %>%
mutate(LC_L1 = case_when(
coct == 1 & HBT_CNDT %in% c("good", "fair") ~"nat",
coct == 0 & LC == 1 ~ "nat",
TRUE  ~"notnat"))
testsum <- coct_rall %>%
filter(T_MAPCODE != "NOTVEG") %>%
group_by(LC_L1) %>%
summarise(km2tot = sum(km2))
View(testsum)
testsum <- coct_rall %>%
#filter(T_MAPCODE != "NOTVEG") %>%
group_by(LC_L1) %>%
summarise(km2tot = sum(km2))
View(testsum)
View(testsum)
View(coct_r)
View(cond_r)
View(nlc)
View(vegrast)
View(coct_rall)
plot(cond_r)
print(cats(cond_r))
unique <- unique(cond_r)
View(unique)
reclasstable <- data.frame(old = c("Fair", "Good","Irreversibly modified", "Natural aquatic habitat", "Poor"), new  = c("deg", "nat", "notnat", "nat", "notnat"))
cond_r_rc <- classify(cond_r, reclasstable)
coct_r <- as.factor(coct)
coct_r <- as.factor(coct)
#load packages
library(terra)
library(tidyverse)
library(sf)
library(PROJ)
# Add City of Cape Town Land COver and Condition 2023 (prepared in ARCGIS PRO), where 0 = inside AOI but no value assigned, 4 = notnat, 2 = sec nat, 8 = severely degraded.
coct <- rast("C:/Users/skownoa/Dropbox/NBAwork/RLEworking/CoCT/coct_cond9.tif")
# Add national LC, resample to match 30m AEA grid used for supplementary analysis
nlc <- rast("C:/Users/skownoa/Dropbox/NBAwork/NLC_change/nlc2022_7class.tif" )
